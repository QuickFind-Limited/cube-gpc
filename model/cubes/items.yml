cubes:
  - name: items
    sql: SELECT * FROM gpc.items
    title: Items
    description: Product master data with dimensions like category, season, size, color

    measures:
      - name: item_count
        type: count
        description: Total number of SKUs (size variants). LIFE001 NOTE - This counts SKUs, not products. For product count, use product_count measure.

      - name: product_count
        sql: "{CUBE}.custitem_gpc_stylenumber"
        type: count_distinct_approx
        description: >
          Total number of products (unique style numbers). LIFE001 FIX - Counts distinct products, not SKUs.
          GPC has ~25 SKUs per product (much higher than typical 7:1 ratio due to size/color variations).
          Use this for "How many products..." questions. Use item_count for "How many SKUs..." questions.

      - name: active_item_count
        type: count
        filters:
          - sql: "{CUBE}.isinactive = FALSE"
        description: Number of active SKUs (not products)

      - name: active_product_count
        sql: "{CUBE}.custitem_gpc_stylenumber"
        type: count_distinct_approx
        filters:
          - sql: "{CUBE}.isinactive = FALSE"
        description: Number of active products (unique style numbers, inactive excluded)

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: itemid
        sql: "{CUBE}.itemid"
        type: string
        title: SKU
        description: Item SKU code

      - name: itemtype
        sql: "{CUBE}.itemtype"
        type: string
        description: Item type (e.g., InvtPart, Kit, NonInvtPart)

      - name: displayname
        sql: "{CUBE}.displayname"
        type: string
        title: Product Name
        description: Product display name

      - name: category
        sql: "{CUBE}.custitem_gpc_category"
        type: string
        description: Product category

      - name: gender
        sql: "{CUBE}.custitem_gpc_category"
        type: string
        description: Product gender/category (Men, Women, Unisex, Children, etc.) - alias for category

      - name: section
        sql: "{CUBE}.custitem_gpc_sections"
        type: string
        description: Product section (e.g., Hoodies, Fleeces, Sweatshirts, Leggings)

      - name: season
        sql: "{CUBE}.custitem_gpc_season"
        type: string
        description: Product season (e.g., AW25, SS24)

      - name: size
        sql: "{CUBE}.custitem_gpc_size"
        type: string
        description: Product size

      - name: range
        sql: "{CUBE}.custitem_gpc_range"
        type: string
        description: Product range

      - name: collection
        sql: "{CUBE}.custitem_gpc_collection"
        type: string
        description: Product collection

      - name: fabric
        sql: "{CUBE}.custitem_gpc_fabric"
        type: string
        description: Product fabric

      - name: color
        sql: "{CUBE}.custitem_gpc_child_colour"
        type: string
        description: Product color (child colour)

      - name: parent_color
        sql: "{CUBE}.custitem_gpc_parent_colour"
        type: string
        description: Product parent color

      - name: style_number
        sql: "{CUBE}.custitem_gpc_stylenumber"
        type: string
        title: Product Style Number
        description: Style number - unique product identifier (multiple SKUs share same style number)

      - name: season_type
        sql: "{CUBE}.custitem_gpc_seasontype"
        type: string
        description: Season type (Core, Fashion, etc.)

      - name: is_inactive
        sql: "{CUBE}.isinactive"
        type: boolean
        description: Whether item is inactive

      - name: cost
        sql: "{CUBE}.cost"
        type: number
        description: Item cost

      - name: base_price
        sql: "{CUBE}.baseprice"
        type: number
        description: Base price

      - name: description
        sql: "{CUBE}.salesdescription"
        type: string
        description: Sales description

      - name: has_dimensions
        sql: "CASE WHEN {CUBE}.custitem_gpc_category IS NOT NULL THEN 'Yes' ELSE 'No' END"
        type: string
        description: Whether item has product dimensions

      - name: markdown
        sql: "{CUBE}.custitemmarkdown"
        type: string
        description: Markdown status for inventory analysis

    segments:
      - name: categorized_products
        sql: "{CUBE}.custitem_gpc_category IS NOT NULL"

      - name: active_products
        sql: "{CUBE}.isinactive = FALSE"

      - name: with_season
        sql: "{CUBE}.custitem_gpc_season IS NOT NULL"

    pre_aggregations:
      - name: item_analysis
        measures:
          - item_count
          - active_item_count
          - product_count  # LIFE001 fix - product (style number) count
          - active_product_count  # LIFE001 fix - active product count
        dimensions:
          - category
          - gender
          - section
          - season
          - size
          - color
          - itemtype
          - season_type
          - markdown  # LIFE001 - needed for full price vs markdown analysis
        refresh_key:
          every: 1 day
