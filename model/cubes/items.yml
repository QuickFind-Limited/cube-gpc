cubes:
  - name: items
    sql: SELECT * FROM `gpc_data_2026_01_26.items`
    title: Items
    description: >
      Product master data with dimensions like category, season, size, color.
      Grain: one row per inventory item/product.

    measures:
      - name: item_count
        type: count
        description: Total number of items

      - name: active_item_count
        type: count
        filters:
          - sql: "{{CUBE}}.is_inactive = FALSE"
        description: Number of active items

      - name: total_quantity_available
        sql: "CAST({{CUBE}}.quantity_available AS FLOAT64)"
        type: sum
        description: Total quantity available across all items

      - name: avg_quantity_available
        sql: "CAST({{CUBE}}.quantity_available AS FLOAT64)"
        type: avg
        description: Average quantity available per item

    dimensions:
      - name: item_id
        sql: "{{CUBE}}.item_id"
        type: number
        primary_key: true
        description: Unique identifier for the item

      - name: item_code
        sql: "{{CUBE}}.item_code"
        type: string
        title: SKU
        description: Item SKU code

      - name: item_name
        sql: "{{CUBE}}.item_name"
        type: string
        title: Product Name
        description: Product display name

      - name: item_fullname
        sql: "{{CUBE}}.item_fullname"
        type: string
        description: Full product name including all attributes

      - name: item_description
        sql: "{{CUBE}}.item_description"
        type: string
        description: Product description

      - name: item_type
        sql: "{{CUBE}}.item_type"
        type: string
        description: Item type (e.g., InvtPart, Kit, NonInvtPart)

      - name: matrix_type
        sql: "{{CUBE}}.matrix_type"
        type: string
        description: Matrix type (PARENT, CHILD, or standalone)

      - name: costing_method
        sql: "{{CUBE}}.costing_method"
        type: string
        description: Inventory costing method code

      - name: costing_method_display
        sql: "{{CUBE}}.costing_method_display"
        type: string
        description: Human-readable costing method (e.g., Average, FIFO)

      - name: quantity_available
        sql: "CAST({{CUBE}}.quantity_available AS FLOAT64)"
        type: number
        description: Current quantity available in inventory

      - name: is_inactive
        sql: "{{CUBE}}.is_inactive"
        type: boolean
        description: Whether item is inactive

      - name: is_online
        sql: "{{CUBE}}.is_online"
        type: boolean
        description: Whether item is available for online sales

      - name: is_dropship_item
        sql: "{{CUBE}}.is_dropship_item"
        type: boolean
        description: Whether item is fulfilled via dropship

      - name: is_special_order_item
        sql: "{{CUBE}}.is_special_order_item"
        type: boolean
        description: Whether item requires special ordering

      - name: is_fulfillable
        sql: "{{CUBE}}.is_fulfillable"
        type: boolean
        description: Whether item can be fulfilled from inventory

      - name: subsidiary_id
        sql: "{{CUBE}}.subsidiary_id"
        type: number
        description: Associated subsidiary

      - name: income_account_id
        sql: "{{CUBE}}.income_account_id"
        type: number
        description: Associated income account for revenue recognition

      - name: last_modified_date
        sql: "TIMESTAMP({{CUBE}}.last_modified_date)"
        type: time
        description: Date when item was last modified

      - name: created_date
        sql: "TIMESTAMP({{CUBE}}.created_date)"
        type: time
        description: Date when item was created

      # Custom dimensions preserved from original cube
      - name: category
        sql: "{{CUBE}}.custitem_gpc_category"
        type: string
        description: Product category

      - name: section
        sql: "{{CUBE}}.custitem_gpc_sections"
        type: string
        description: Product section (e.g., Hoodies, Fleeces, Sweatshirts, Leggings)

      - name: season
        sql: "{{CUBE}}.custitem_gpc_season"
        type: string
        description: Product season (e.g., AW25, SS24)

      - name: size
        sql: "{{CUBE}}.custitem_gpc_size"
        type: string
        description: Product size

      - name: range
        sql: "{{CUBE}}.custitem_gpc_range"
        type: string
        description: Product range

      - name: collection
        sql: "{{CUBE}}.custitem_gpc_collection"
        type: string
        description: Product collection

      - name: fabric
        sql: "{{CUBE}}.custitem_gpc_fabric"
        type: string
        description: Product fabric

      - name: color
        sql: "{{CUBE}}.custitem_gpc_child_colour"
        type: string
        description: Product color (child colour)

      - name: parent_color
        sql: "{{CUBE}}.custitem_gpc_parent_colour"
        type: string
        description: Product parent color

      - name: style_number
        sql: "{{CUBE}}.custitem_gpc_style_number"
        type: string
        description: Style number

      - name: season_type
        sql: "{{CUBE}}.custitem_gpc_seasontype"
        type: string
        description: Season type (Core, Fashion, etc.)

      - name: cost
        sql: "{{CUBE}}.cost"
        type: number
        description: Item cost

      - name: base_price
        sql: "{{CUBE}}.baseprice"
        type: number
        description: Base price

      - name: has_dimensions
        sql: "CASE WHEN {{CUBE}}.custitem_gpc_category IS NOT NULL THEN 'Yes' ELSE 'No' END"
        type: string
        description: Whether item has product dimensions

      - name: markdown
        sql: "{{CUBE}}.custitemmarkdown"
        type: string
        description: Markdown status for inventory analysis

    joins:
      - name: dim_subsidiary
        relationship: many_to_one
        sql: "{{CUBE}}.subsidiary_id = {{dim_subsidiary.subsidiary_id}}"

      - name: dim_account
        relationship: many_to_one
        sql: "{{CUBE}}.income_account_id = {{dim_account.account_id}}"

    segments:
      - name: categorized_products
        sql: "{{CUBE}}.custitem_gpc_category IS NOT NULL"
        description: Products with category classification

      - name: active_products
        sql: "{{CUBE}}.is_inactive = FALSE"
        description: Active items only

      - name: with_season
        sql: "{{CUBE}}.custitem_gpc_season IS NOT NULL"
        description: Products with season classification

      - name: online_available
        sql: "{{CUBE}}.is_online = TRUE"
        description: Items available for online sales

      - name: in_stock
        sql: "CAST({{CUBE}}.quantity_available AS FLOAT64) > 0"
        description: Items with available inventory

      - name: fulfillable_items
        sql: "{{CUBE}}.is_fulfillable = TRUE"
        description: Items that can be fulfilled from inventory

      - name: matrix_children
        sql: "{{CUBE}}.matrix_type = 'CHILD'"
        description: Child items in matrix (SKU variants)

      - name: matrix_parents
        sql: "{{CUBE}}.matrix_type = 'PARENT'"
        description: Parent items in matrix (master products)

    pre_aggregations:
      - name: item_analysis
        measures:
          - item_count
          - active_item_count
          - total_quantity_available
        dimensions:
          - category
          - section
          - season
          - size
          - color
          - item_type
          - season_type
          - matrix_type
          - is_inactive
          - is_online
        refresh_key:
          every: 1 day
