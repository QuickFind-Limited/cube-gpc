cubes:
  - name: items
    sql: SELECT * FROM gpc.items
    title: Items
    description: Product master data with dimensions like category, season, size, color

    measures:
      - name: item_count
        type: count
        description: Total number of items

      - name: active_item_count
        type: count
        filters:
          - sql: "{CUBE}.isinactive = 'F'"
        description: Number of active items

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: itemid
        sql: "{CUBE}.itemid"
        type: string
        title: SKU
        description: Item SKU code

      - name: itemtype
        sql: "{CUBE}.itemtype"
        type: string
        description: Item type (e.g., InvtPart, Kit, NonInvtPart)

      - name: displayname
        sql: "{CUBE}.displayname"
        type: string
        title: Product Name
        description: Product display name

      - name: category
        sql: "{CUBE}.custitem_gpc_category"
        type: string
        description: Product category

      - name: season
        sql: "{CUBE}.custitem_gpc_season"
        type: string
        description: Product season (e.g., AW25, SS24)

      - name: size
        sql: "{CUBE}.custitem_gpc_size"
        type: string
        description: Product size

      - name: range
        sql: "{CUBE}.custitem_gpc_range"
        type: string
        description: Product range

      - name: collection
        sql: "{CUBE}.custitem_gpc_collection"
        type: string
        description: Product collection

      - name: fabric
        sql: "{CUBE}.custitem_gpc_fabric"
        type: string
        description: Product fabric

      - name: color
        sql: "{CUBE}.custitem_gpc_child_colour"
        type: string
        description: Product color (child colour)

      - name: parent_color
        sql: "{CUBE}.custitem_gpc_parent_colour"
        type: string
        description: Product parent color

      - name: style_number
        sql: "{CUBE}.custitem_gpc_style_number"
        type: string
        description: Style number

      - name: season_type
        sql: "{CUBE}.custitem_gpc_seasontype"
        type: string
        description: Season type (Core, Fashion, etc.)

      - name: is_inactive
        sql: "{CUBE}.isinactive"
        type: string
        description: Whether item is inactive

      - name: cost
        sql: "{CUBE}.cost"
        type: number
        description: Item cost

      - name: base_price
        sql: "{CUBE}.baseprice"
        type: number
        description: Base price

      - name: description
        sql: "{CUBE}.salesdescription"
        type: string
        description: Sales description

      - name: has_dimensions
        sql: "CASE WHEN {CUBE}.custitem_gpc_category IS NOT NULL THEN 'Yes' ELSE 'No' END"
        type: string
        description: Whether item has product dimensions

      - name: markdown
        sql: "{CUBE}.custitemmarkdown"
        type: string
        description: Markdown status for inventory analysis

    segments:
      - name: categorized_products
        sql: "{CUBE}.custitem_gpc_category IS NOT NULL"

      - name: active_products
        sql: "{CUBE}.isinactive = 'F'"

      - name: with_season
        sql: "{CUBE}.custitem_gpc_season IS NOT NULL"

    pre_aggregations:
      - name: item_analysis
        measures:
          - item_count
          - active_item_count
        dimensions:
          - category
          - season
          - size
          - color
          - itemtype
          - season_type
        refresh_key:
          every: 24 hour
