cubes:
  - name: vendors
    sql_table: gpc.vendors

    title: Vendors
    description: >
      Vendor/supplier master data from NetSuite (Schema updated 2026-02-02 - now includes 62 fields from typed Parquet conversion).
      FIX (v68.4): Corrected field names to camelCase (Parquet native format): entityId, isInactive, isPerson, dateCreated, lastModifiedDate.
      FIX (v68.5): Changed currency from nested object to JOIN - typed Parquet extracted currency as INTEGER ID, not STRUCT with refName.
      FIX (v68.9): Fixed active_vendor_count filter to use isInactive instead of is_inactive (missed in v68.4).

    measures:
      - name: vendor_count
        type: count
        description: Number of vendors

      - name: active_vendor_count
        type: count
        filters:
          - sql: "{CUBE}.isInactive = false"
        description: Number of active vendors

      - name: total_vendor_balance
        sql: balance
        type: sum
        format: currency
        description: Total outstanding balance across all vendors

    dimensions:
      - name: id
        sql: id
        type: number
        primary_key: true
        public: true
        title: Vendor ID
        description: Vendor internal ID

      - name: vendor_name
        sql: "entityId"
        type: string
        title: Vendor Name
        description: Vendor company name (entityId from NetSuite)

      - name: is_inactive
        sql: "isInactive"
        type: boolean
        title: Is Inactive
        description: Whether the vendor is inactive

      - name: is_person
        sql: "isPerson"
        type: boolean
        title: Is Person
        description: Whether the vendor is a person (vs company)

      - name: balance
        sql: balance
        type: number
        format: currency
        title: Balance
        description: Current outstanding balance

      - name: currency_id
        sql: "currency"
        type: number
        title: Currency ID
        description: Vendor's default currency ID (reference to currencies table)

      - name: currency_name
        sql: "{currencies.name}"
        type: string
        title: Currency
        description: Vendor's default currency code (from currencies table)

      - name: date_created
        sql: "dateCreated"
        type: time
        title: Date Created
        description: Date vendor record was created

      - name: last_modified_date
        sql: "lastModifiedDate"
        type: time
        title: Last Modified
        description: Date vendor record was last modified

      - name: factory_code
        sql: "custentityfactory_code"
        type: string
        title: Factory Code
        description: >
          Factory code (e.g., CN0001, GB0021). PO002 FIX - Only 22 of 1,136 vendors have this field
          (manufacturing/production vendors only). Format: country ISO2 + sequential number.

      - name: company_name
        sql: "companyName"
        type: string
        title: Company Name
        description: Vendor company name (companyName from NetSuite REST API). 99.7% coverage.

    joins:
      - name: currencies
        relationship: many_to_one
        sql: "{CUBE}.currency = {currencies.id}"

    pre_aggregations:
      - name: vendors_summary
        measures:
          - vendor_count
          - active_vendor_count
          - total_vendor_balance
        dimensions:
          - id
          - vendor_name
          - is_inactive
          - is_person
          - currency_name
          - factory_code    # PO002 fix
          - company_name    # PO002 fix
        refresh_key:
          every: 1 day
