cubes:
  - name: dim_location
    sql: SELECT * FROM gpc_data_2026_01_26.dim_location
    title: Locations
    description: >
      Warehouse and retail store locations with geolocation data.
      Grain: one row per location.

    joins:
      - name: dim_subsidiary
        relationship: many_to_one
        sql: "{CUBE}.subsidiary_id = {dim_subsidiary.subsidiary_id}"

    measures:
      - name: location_count
        type: count
        description: Total number of locations

      - name: avg_latitude
        sql: "CAST({CUBE}.latitude AS FLOAT64)"
        type: avg
        description: Average latitude of locations

      - name: avg_longitude
        sql: "CAST({CUBE}.longitude AS FLOAT64)"
        type: avg
        description: Average longitude of locations

    dimensions:
      - name: location_id
        sql: "{CUBE}.location_id"
        type: number
        primary_key: true
        description: Unique identifier for the location

      - name: location_name
        sql: "{CUBE}.location_name"
        type: string
        description: Short name of the location

      - name: location_fullname
        sql: "{CUBE}.location_fullname"
        type: string
        description: Full hierarchical name of the location

      - name: location_external_id
        sql: "{CUBE}.location_external_id"
        type: string
        description: External system identifier for the location

      - name: location_type_id
        sql: "{CUBE}.location_type_id"
        type: number
        description: Location type identifier (FK to location types)

      - name: location_type
        sql: "{CUBE}.location_type"
        type: string
        description: Type of location (e.g., Retail Store, Warehouse, Distribution Center)

      - name: is_sellable_location
        sql: "{CUBE}.is_sellable_location"
        type: boolean
        description: True if this location can sell inventory directly to customers

      - name: subsidiary_id
        sql: "{CUBE}.subsidiary_id"
        type: number
        description: Subsidiary that owns this location

      - name: is_inactive
        sql: "{CUBE}.is_inactive"
        type: boolean
        description: True if the location is inactive/closed

      - name: make_inventory_available
        sql: "{CUBE}.make_inventory_available"
        type: boolean
        description: True if inventory at this location is available for fulfillment

      - name: include_in_control_tower
        sql: "{CUBE}.include_in_control_tower"
        type: boolean
        description: True if location is included in supply chain control tower visibility

      - name: geolocation_method
        sql: "{CUBE}.geolocation_method"
        type: string
        description: Method used to determine geolocation (e.g., POSTALCODE, LATLONG)

      - name: latitude
        sql: "CAST({CUBE}.latitude AS FLOAT64)"
        type: number
        description: Geographic latitude coordinate

      - name: longitude
        sql: "CAST({CUBE}.longitude AS FLOAT64)"
        type: number
        description: Geographic longitude coordinate

      - name: last_modified_date
        sql: "TIMESTAMP({CUBE}.last_modified_date)"
        type: time
        description: Date when the location record was last modified

      - name: main_address_id
        sql: "{CUBE}.main_address_id"
        type: number
        description: Primary address identifier for this location

    segments:
      - name: active_locations
        sql: "{CUBE}.is_inactive = false"
        description: "Excludes inactive/closed locations"

      - name: sellable_locations
        sql: "{CUBE}.is_sellable_location = true"
        description: "Locations that can sell directly to customers (retail stores)"

      - name: fulfillment_locations
        sql: "{CUBE}.make_inventory_available = true"
        description: "Locations with inventory available for fulfillment"

      - name: retail_stores
        sql: "{CUBE}.location_type = 'Retail Store' OR {CUBE}.is_sellable_location = true"
        description: "Retail store locations only"

      - name: warehouses
        sql: "{CUBE}.location_type IN ('Warehouse', 'Distribution Center') OR ({CUBE}.is_sellable_location = false AND {CUBE}.make_inventory_available = true)"
        description: "Warehouse and distribution center locations"

      - name: control_tower_locations
        sql: "{CUBE}.include_in_control_tower = true"
        description: "Locations included in supply chain control tower"

      - name: geolocated_locations
        sql: "{CUBE}.latitude IS NOT NULL AND {CUBE}.longitude IS NOT NULL AND {CUBE}.latitude BETWEEN -90 AND 90 AND {CUBE}.longitude BETWEEN -180 AND 180"
        description: "Locations with valid geolocation coordinates"
