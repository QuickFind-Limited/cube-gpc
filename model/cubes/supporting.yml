cubes:
  - name: currencies
    sql: SELECT * FROM currencies
    title: Currencies
    description: Currency reference data with exchange rates for multi-currency support

    measures:
      - name: currency_count
        type: count
        description: Total number of currencies

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: name
        sql: "{CUBE}.name"
        type: string
        description: Currency name (EUR, GBP, USD, etc.)

      - name: symbol
        sql: "{CUBE}.symbol"
        type: string
        description: Currency symbol

      - name: exchangerate
        sql: "{CUBE}.exchangerate"
        type: number
        description: Exchange rate to base currency

  - name: subsidiaries
    sql: SELECT * FROM subsidiaries
    title: Subsidiaries
    description: Legal entity reference data for multi-entity accounting

    measures:
      - name: subsidiary_count
        type: count
        description: Total number of subsidiaries

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: name
        sql: "{CUBE}.name"
        type: string
        description: Subsidiary name

      - name: legalname
        sql: "{CUBE}.legalname"
        type: string
        description: Legal company name

      - name: country
        sql: "{CUBE}.country"
        type: string
        description: Country code (IE, GB)

      - name: currency
        sql: "{CUBE}.currency"
        type: number
        description: Currency ID

  - name: departments
    sql: SELECT * FROM departments
    title: Departments
    description: Department reference data (eCommerce, Retail, Wholesale, etc.)

    measures:
      - name: department_count
        type: count
        description: Total number of departments

      - name: active_department_count
        type: count
        filters:
          - sql: "{CUBE}.isinactive = 'F'"
        description: Number of active departments

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: name
        sql: "{CUBE}.name"
        type: string
        description: Department name (eCommerce, Retail, Wholesale)

      - name: fullname
        sql: "{CUBE}.fullname"
        type: string
        description: Full department name

      - name: parent
        sql: "{CUBE}.parent"
        type: number
        description: Parent department ID

      - name: isinactive
        sql: "{CUBE}.isinactive"
        type: string
        description: Whether department is inactive (T/F)

    segments:
      - name: active
        sql: "{CUBE}.isinactive = 'F'"

  - name: classifications
    sql: SELECT * FROM classifications
    title: Classifications
    description: Business classification hierarchy (EU Website, UK Website, Kildare Village, etc.)

    measures:
      - name: classification_count
        type: count
        description: Total number of classifications

      - name: active_count
        type: count
        filters:
          - sql: "{CUBE}.isinactive = 'F'"
        description: Number of active classifications

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: name
        sql: "{CUBE}.name"
        type: string
        description: Classification name (EU Website, UK Website, Kildare Village, etc.)

      - name: parent
        sql: "{CUBE}.parent"
        type: number
        description: Parent classification ID for hierarchy

      - name: isinactive
        sql: "{CUBE}.isinactive"
        type: string
        description: Whether classification is inactive (T/F)

    segments:
      - name: active
        sql: "{CUBE}.isinactive = 'F'"

  - name: fulfillments
    sql: SELECT * FROM fulfillments
    title: Fulfillments
    description: Item fulfillment records tracking shipments and deliveries

    joins:
      - name: transactions
        relationship: many_to_one
        sql: "{CUBE}.entity = {transactions.id}"

    measures:
      - name: fulfillment_count
        type: count
        description: Total number of fulfillments

      - name: unique_orders
        sql: "{CUBE}.entity"
        type: count_distinct
        description: Number of unique orders fulfilled

      - name: shipped_count
        type: count
        filters:
          - sql: "{CUBE}.status = 'C'"
        description: Number of shipped fulfillments

      - name: pending_count
        type: count
        filters:
          - sql: "{CUBE}.status = 'A'"
        description: Number of pending fulfillments

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: entity
        sql: "{CUBE}.entity"
        type: number
        description: Related entity/order ID

      - name: tranid
        sql: "{CUBE}.tranid"
        type: string
        title: Fulfillment Number
        description: Fulfillment transaction ID (e.g., IF279014)

      - name: trandate
        sql: "CAST({CUBE}.trandate AS TIMESTAMP)"
        type: time
        description: Fulfillment date

      - name: month
        sql: "DATE_TRUNC('month', CAST({CUBE}.trandate AS TIMESTAMP))"
        type: time
        description: Fulfillment month

      - name: status
        sql: "{CUBE}.status"
        type: string
        description: "Fulfillment status: A (Pending), B (Picked), C (Shipped)"

      - name: status_name
        sql: >
          CASE
            WHEN {CUBE}.status = 'A' THEN 'Pending'
            WHEN {CUBE}.status = 'B' THEN 'Picked'
            WHEN {CUBE}.status = 'C' THEN 'Shipped'
            ELSE 'Unknown'
          END
        type: string
        description: Human-readable fulfillment status

      - name: shipcarrier
        sql: "{CUBE}.shipcarrier"
        type: string
        description: Shipping carrier name

      - name: shipmethod
        sql: "{CUBE}.shipmethod"
        type: number
        description: Shipping method ID

    segments:
      - name: shipped
        sql: "{CUBE}.status = 'C'"

      - name: pending
        sql: "{CUBE}.status = 'A'"

      - name: picked
        sql: "{CUBE}.status = 'B'"

  - name: fulfillment_lines
    sql: SELECT * FROM fulfillment_lines
    title: Fulfillment Lines
    description: Individual line items for fulfillments tracking what products were shipped

    joins:
      - name: fulfillments
        relationship: many_to_one
        sql: "{CUBE}.transaction = {fulfillments.id}"

      - name: items
        relationship: many_to_one
        sql: "{CUBE}.item = {items.id}"

      - name: locations
        relationship: many_to_one
        sql: "{CUBE}.location = {locations.id}"

    measures:
      - name: line_count
        type: count
        description: Total number of fulfillment lines

      - name: units_shipped
        sql: "CAST({CUBE}.quantity AS DOUBLE)"
        type: sum
        description: Total units shipped

      - name: fulfillment_count
        sql: "{CUBE}.transaction"
        type: count_distinct
        description: Number of unique fulfillments

      - name: sku_count
        sql: "{CUBE}.item"
        type: count_distinct
        description: Number of unique SKUs shipped

      - name: location_count
        sql: "{CUBE}.location"
        type: count_distinct
        description: Number of shipping locations

    dimensions:
      - name: id
        sql: "{CUBE}.id"
        type: number
        primary_key: true

      - name: transaction
        sql: "{CUBE}.transaction"
        type: number
        description: Parent fulfillment ID

      - name: createdfrom
        sql: "{CUBE}.createdfrom"
        type: number
        description: Source order ID

      - name: item
        sql: "{CUBE}.item"
        type: number
        description: Item ID

      - name: location
        sql: "{CUBE}.location"
        type: number
        description: Shipping location ID

      - name: quantity
        sql: "{CUBE}.quantity"
        type: number
        description: Quantity shipped

      - name: quantityshiprecv
        sql: "{CUBE}.quantityshiprecv"
        type: number
        description: Quantity shipped/received

      - name: shipdate
        sql: "CAST({CUBE}.shipdate AS TIMESTAMP)"
        type: time
        description: Ship date

      - name: month
        sql: "DATE_TRUNC('month', CAST({CUBE}.shipdate AS TIMESTAMP))"
        type: time
        description: Ship month

    segments:
      - name: shipped_lines
        sql: "{CUBE}.quantity > 0"
